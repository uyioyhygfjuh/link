# Referral System - Visual Flow Documentation

**Version**: 1.0  
**Last Updated**: January 2025  
**Purpose**: Visual representation of the referral system flows

---

## ğŸ¨ System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LINKGUARD REFERRAL SYSTEM                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚â—„â”€â”€â”€â”€â–ºâ”‚   Firebase   â”‚â—„â”€â”€â”€â”€â–ºâ”‚   Firestore  â”‚
â”‚   (Next.js)  â”‚      â”‚     Auth     â”‚      â”‚   Database   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                            â”‚
       â”‚                                            â”‚
       â–¼                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Components  â”‚                          â”‚  Collections â”‚
â”‚              â”‚                          â”‚              â”‚
â”‚ - Signup     â”‚                          â”‚ - users/     â”‚
â”‚ - Dashboard  â”‚                          â”‚ - referrals/ â”‚
â”‚ - Account    â”‚                          â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Flow 1: User Registration with Referral

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  NEW USER SIGNUP FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER A (Referrer)                    SYSTEM                    USER B (Referred)
     â”‚                                  â”‚                            â”‚
     â”‚  1. Generates referral code      â”‚                            â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
     â”‚  (JOH4K7LM)                      â”‚                            â”‚
     â”‚                                  â”‚                            â”‚
     â”‚  2. Shares link                  â”‚                            â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚  /signup?ref=JOH4K7LM            â”‚                            â”‚
     â”‚                                  â”‚                            â”‚
     â”‚                                  â”‚  3. Opens link             â”‚
     â”‚                                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                  â”‚                            â”‚
     â”‚                                  â”‚  4. Validates code         â”‚
     â”‚                                  â”‚â—„â”€â”€â”                        â”‚
     â”‚                                  â”‚   â”‚ findUserByReferralCode()
     â”‚                                  â”‚â—„â”€â”€â”˜                        â”‚
     â”‚                                  â”‚                            â”‚
     â”‚                                  â”‚  5. Shows "Referred by"    â”‚
     â”‚                                  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                                  â”‚                            â”‚
     â”‚                                  â”‚  6. User B signs up        â”‚
     â”‚                                  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                                  â”‚                            â”‚
     â”‚                                  â”‚  7. Creates user account   â”‚
     â”‚                                  â”‚â—„â”€â”€â”                        â”‚
     â”‚                                  â”‚   â”‚ signUpWithEmail()      â”‚
     â”‚                                  â”‚â—„â”€â”€â”˜                        â”‚
     â”‚                                  â”‚                            â”‚
     â”‚                                  â”‚  8. Creates referral data  â”‚
     â”‚                                  â”‚â—„â”€â”€â”                        â”‚
     â”‚                                  â”‚   â”‚ createReferralData()   â”‚
     â”‚                                  â”‚   â”‚ - User B: referredBy=A â”‚
     â”‚                                  â”‚â—„â”€â”€â”˜                        â”‚
     â”‚                                  â”‚                            â”‚
     â”‚  9. Updates referrer stats       â”‚                            â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
     â”‚  referralCount++                 â”‚                            â”‚
     â”‚  referrals.push(User B)          â”‚                            â”‚
     â”‚                                  â”‚                            â”‚
     â”‚ 10. Sees +1 referral on          â”‚                            â”‚
     â”‚     dashboard                    â”‚                            â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
     â”‚                                  â”‚                            â”‚
```

---

## ğŸ’° Flow 2: Commission Earning Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  COMMISSION EARNING FLOW                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REFERRED USER              PAYMENT SYSTEM           REFERRER
     â”‚                           â”‚                      â”‚
     â”‚  1. Subscribes to plan    â”‚                      â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚
     â”‚  ($10/month)              â”‚                      â”‚
     â”‚                           â”‚                      â”‚
     â”‚                           â”‚  2. Calculate comm.  â”‚
     â”‚                           â”‚â—„â”€â”€â”                  â”‚
     â”‚                           â”‚   â”‚ 15% = $1.50      â”‚
     â”‚                           â”‚â—„â”€â”€â”˜                  â”‚
     â”‚                           â”‚                      â”‚
     â”‚                           â”‚  3. Record earnings  â”‚
     â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                           â”‚  status: "pending"   â”‚
     â”‚                           â”‚  amount: $1.50       â”‚
     â”‚                           â”‚                      â”‚
     â”‚                           â”‚                      â”‚
     â”‚                      [7 DAY HOLD PERIOD]         â”‚
     â”‚                           â”‚                      â”‚
     â”‚                           â”‚                      â”‚
     â”‚                           â”‚  4. Confirm earnings â”‚
     â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                           â”‚  status: "completed" â”‚
     â”‚                           â”‚  move to available   â”‚
     â”‚                           â”‚                      â”‚
     â”‚                           â”‚  5. Views earnings   â”‚
     â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                           â”‚  Available: $1.50    â”‚
     â”‚                           â”‚                      â”‚
```

### Commission Calculation Table

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Subscription     â”‚ Amount      â”‚ Commission   â”‚ Earnings     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Monthly Basic    â”‚ $10/month   â”‚ 15%          â”‚ $1.50        â”‚
â”‚ Monthly Pro      â”‚ $20/month   â”‚ 15%          â”‚ $3.00        â”‚
â”‚ Monthly Premium  â”‚ $30/month   â”‚ 15%          â”‚ $4.50        â”‚
â”‚ Yearly Basic     â”‚ $100/year   â”‚ 20%          â”‚ $20.00       â”‚
â”‚ Yearly Pro       â”‚ $200/year   â”‚ 20%          â”‚ $40.00       â”‚
â”‚ Yearly Premium   â”‚ $300/year   â”‚ 20%          â”‚ $60.00       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¸ Flow 3: Withdrawal Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WITHDRAWAL REQUEST FLOW                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USER                       SYSTEM                      ADMIN
 â”‚                           â”‚                           â”‚
 â”‚  1. Opens withdrawal      â”‚                           â”‚
 â”‚     modal                 â”‚                           â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚
 â”‚                           â”‚                           â”‚
 â”‚  2. Checks balance        â”‚                           â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚
 â”‚  Available: $50.00        â”‚                           â”‚
 â”‚                           â”‚                           â”‚
 â”‚  3. Enters amount: $25    â”‚                           â”‚
 â”‚  4. Selects PayPal        â”‚                           â”‚
 â”‚  5. Enters email          â”‚                           â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚
 â”‚                           â”‚                           â”‚
 â”‚                           â”‚  6. Validates             â”‚
 â”‚                           â”‚â—„â”€â”€â”                       â”‚
 â”‚                           â”‚   â”‚ amount <= available   â”‚
 â”‚                           â”‚   â”‚ amount >= $10         â”‚
 â”‚                           â”‚   â”‚ email format valid    â”‚
 â”‚                           â”‚â—„â”€â”€â”˜                       â”‚
 â”‚                           â”‚                           â”‚
 â”‚                           â”‚  7. Creates withdrawal    â”‚
 â”‚                           â”‚â—„â”€â”€â”                       â”‚
 â”‚                           â”‚   â”‚ status: "pending"     â”‚
 â”‚                           â”‚   â”‚ deduct from available â”‚
 â”‚                           â”‚â—„â”€â”€â”˜                       â”‚
 â”‚                           â”‚                           â”‚
 â”‚  8. Confirmation          â”‚                           â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚
 â”‚  "Request submitted"      â”‚                           â”‚
 â”‚                           â”‚                           â”‚
 â”‚                           â”‚  9. Notifies admin        â”‚
 â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
 â”‚                           â”‚                           â”‚
 â”‚                           â”‚ 10. Admin processes       â”‚
 â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚                           â”‚     payout                â”‚
 â”‚                           â”‚                           â”‚
 â”‚                           â”‚ 11. Updates status        â”‚
 â”‚                           â”‚â—„â”€â”€â”                       â”‚
 â”‚                           â”‚   â”‚ status: "completed"   â”‚
 â”‚                           â”‚   â”‚ totalWithdrawn += $25 â”‚
 â”‚                           â”‚â—„â”€â”€â”˜                       â”‚
 â”‚                           â”‚                           â”‚
 â”‚ 12. Views updated history â”‚                           â”‚
 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚
 â”‚  Status: "Completed"      â”‚                           â”‚
 â”‚  Date: [timestamp]        â”‚                           â”‚
 â”‚                           â”‚                           â”‚
```

---

## ğŸ—„ï¸ Flow 4: Data Structure & Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FIRESTORE DATA STRUCTURE                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

users/{userId}
â”œâ”€â”€ fullName: "John Doe"
â”œâ”€â”€ email: "john@example.com"
â”œâ”€â”€ plan: "Premium"
â””â”€â”€ ...

        â”‚
        â”‚ userId reference
        â–¼

referrals/{userId}
â”œâ”€â”€ referralCode: "JOH4K7LM"
â”œâ”€â”€ referredBy: "{referrerId}" or null
â”œâ”€â”€ referredByName: "Jane Smith" or null
â”œâ”€â”€ referralCount: 5
â”œâ”€â”€ totalEarnings: 125.50
â”œâ”€â”€ availableBalance: 45.00
â”œâ”€â”€ pendingBalance: 15.00
â”œâ”€â”€ totalWithdrawn: 65.50
â”‚
â”œâ”€â”€ referrals: [
â”‚     {
â”‚       userId: "abc123",
â”‚       userName: "User One",
â”‚       email: "user1@test.com",
â”‚       signupDate: "2025-01-15T10:00:00Z",
â”‚       status: "active",
â”‚       subscription: {
â”‚         plan: "Premium",
â”‚         type: "monthly",
â”‚         amount: 30,
â”‚         startDate: "2025-01-16T12:00:00Z"
â”‚       }
â”‚     },
â”‚     { ... }
â”‚   ]
â”‚
â”œâ”€â”€ earnings: [
â”‚     {
â”‚       id: "earning_001",
â”‚       userId: "abc123",
â”‚       userName: "User One",
â”‚       amount: 30,
â”‚       commission: 4.50,
â”‚       subscriptionType: "monthly",
â”‚       date: "2025-01-16T12:00:00Z",
â”‚       status: "completed"
â”‚     },
â”‚     { ... }
â”‚   ]
â”‚
â””â”€â”€ withdrawals: [
      {
        id: "withdrawal_001",
        amount: 25.00,
        method: "paypal",
        details: {
          email: "john@paypal.com"
        },
        status: "completed",
        requestDate: "2025-01-20T10:00:00Z",
        completedDate: "2025-01-21T15:30:00Z"
      },
      { ... }
    ]
```

---

## ğŸ¯ Flow 5: User Journey Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USER JOURNEY MAP                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NEW USER (Referred)
â”‚
â”œâ”€â–º 1. Clicks referral link
â”‚   â””â”€â–º URL: /signup?ref=CODE
â”‚
â”œâ”€â–º 2. Sees referral banner
â”‚   â””â”€â–º "You were referred by [Name]!"
â”‚
â”œâ”€â–º 3. Signs up for account
â”‚   â”œâ”€â–º Email signup
â”‚   â””â”€â–º OR Google OAuth
â”‚
â”œâ”€â–º 4. Account created
â”‚   â””â”€â–º Referral attribution recorded
â”‚
â”œâ”€â–º 5. Explores free trial
â”‚   â””â”€â–º Tests LinkGuard features
â”‚
â”œâ”€â–º 6. Subscribes to paid plan
â”‚   â””â”€â–º Referrer earns commission (pending)
â”‚
â””â”€â–º 7. Becomes active user


REFERRER JOURNEY
â”‚
â”œâ”€â–º 1. Signs up for LinkGuard
â”‚   â””â”€â–º Receives unique referral code
â”‚
â”œâ”€â–º 2. Discovers referral program
â”‚   â”œâ”€â–º Dashboard: ReferralCard
â”‚   â””â”€â–º Account page: Referral tab
â”‚
â”œâ”€â–º 3. Shares referral link
â”‚   â”œâ”€â–º Copy link
â”‚   â”œâ”€â–º Share on social media
â”‚   â””â”€â–º Send to friends
â”‚
â”œâ”€â–º 4. Tracks referrals
â”‚   â”œâ”€â–º Views referral count
â”‚   â”œâ”€â–º Sees signup dates
â”‚   â””â”€â–º Monitors pending earnings
â”‚
â”œâ”€â–º 5. Earns commissions
â”‚   â”œâ”€â–º Referred user subscribes
â”‚   â”œâ”€â–º 7-day hold period
â”‚   â””â”€â–º Moves to available balance
â”‚
â”œâ”€â–º 6. Requests withdrawal
â”‚   â”œâ”€â–º Accumulates $10+
â”‚   â”œâ”€â–º Fills withdrawal form
â”‚   â””â”€â–º Submits request
â”‚
â””â”€â–º 7. Receives payout
    â”œâ”€â–º Admin processes
    â””â”€â–º Funds transferred
```

---

## ğŸ”„ Flow 6: State Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EARNINGS STATE MACHINE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    Referred user
                    subscribes
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   PENDING      â”‚
                â”‚                â”‚
                â”‚  pendingBalanceâ”‚
                â”‚  +commission   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ After 7 days
                         â”‚ (or admin confirm)
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   COMPLETED    â”‚
                â”‚                â”‚
                â”‚ availableBalanceâ”‚
                â”‚  +commission   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ User withdraws
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   WITHDRAWN    â”‚
                â”‚                â”‚
                â”‚ totalWithdrawn â”‚
                â”‚  +amount       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 WITHDRAWAL STATE MACHINE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    User submits
                    request
                         â”‚
                         â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   PENDING      â”‚
                â”‚                â”‚
                â”‚  Awaiting      â”‚
                â”‚  admin action  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
                    â”‚         â”‚
         Admin      â”‚         â”‚      Admin
         approves   â”‚         â”‚      rejects
                    â”‚         â”‚
                    â–¼         â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ COMPLETED   â”‚  â”‚   FAILED    â”‚
           â”‚             â”‚  â”‚             â”‚
           â”‚ Funds sent  â”‚  â”‚ Refunded to â”‚
           â”‚             â”‚  â”‚ available   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± Flow 7: UI Component Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPONENT STRUCTURE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

app/
â”‚
â”œâ”€â”€ signup/page.tsx
â”‚   â”œâ”€â”€ Referral Code Input
â”‚   â”œâ”€â”€ Real-time Validation
â”‚   â”œâ”€â”€ Referral Banner (if valid)
â”‚   â””â”€â”€ Signup Form
â”‚
â”œâ”€â”€ dashboard/page.tsx
â”‚   â”œâ”€â”€ Header
â”‚   â”œâ”€â”€ Stats Cards
â”‚   â””â”€â”€ ReferralCard â—„â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â”œâ”€â”€ Stats Display     â”‚
â”‚       â”œâ”€â”€ Code/Link Copy    â”‚ components/
â”‚       â””â”€â”€ Recent Referrals  â”‚ ReferralCard.tsx
â”‚                             â”‚
â””â”€â”€ Account/page.tsx          â”‚
    â”œâ”€â”€ Tab Navigation        â”‚
    â”‚   â”œâ”€â”€ Profile           â”‚
    â”‚   â”œâ”€â”€ Security          â”‚
    â”‚   â”œâ”€â”€ Notifications     â”‚
    â”‚   â”œâ”€â”€ Billing           â”‚
    â”‚   â””â”€â”€ Referral â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€â”€ Referral Tab Content
        â”œâ”€â”€ Hero Section
        â”‚   â””â”€â”€ Quick Stats (4 cards)
        â”‚
        â”œâ”€â”€ Main Grid (2 columns)
        â”‚   â”‚
        â”‚   â”œâ”€â”€ Left: Sharing Tools
        â”‚   â”‚   â”œâ”€â”€ Referral Code Card
        â”‚   â”‚   â”œâ”€â”€ Referral Link Card
        â”‚   â”‚   â””â”€â”€ How It Works Card
        â”‚   â”‚
        â”‚   â””â”€â”€ Right: Earnings Sidebar
        â”‚       â”œâ”€â”€ Available Balance
        â”‚       â”œâ”€â”€ Pending Balance
        â”‚       â”œâ”€â”€ Total Withdrawn
        â”‚       â””â”€â”€ Commission Rates
        â”‚
        â””â”€â”€ Full-Width Sections
            â”œâ”€â”€ Recent Earnings Table
            â”œâ”€â”€ Withdrawal History Table
            â””â”€â”€ Your Referrals List
```

---

## ğŸ” Flow 8: Security & Validation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Action                 Validation                  Security Rule
     â”‚                           â”‚                            â”‚
     â”‚  1. Access referral       â”‚                            â”‚
     â”‚     data                  â”‚                            â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚
     â”‚                           â”‚  Check auth token          â”‚
     â”‚                           â”‚â—„â”€â”€â”                        â”‚
     â”‚                           â”‚   â”‚ user.uid exists?       â”‚
     â”‚                           â”‚â—„â”€â”€â”˜                        â”‚
     â”‚                           â”‚                            â”‚
     â”‚                           â”‚  Verify ownership          â”‚
     â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                           â”‚  request.auth.uid ==       â”‚
     â”‚                           â”‚  resource.userId           â”‚
     â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                           â”‚                            â”‚
     â”‚  2. Update withdrawal     â”‚                            â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚
     â”‚                           â”‚  Validate amount           â”‚
     â”‚                           â”‚â—„â”€â”€â”                        â”‚
     â”‚                           â”‚   â”‚ amount >= $10          â”‚
     â”‚                           â”‚   â”‚ amount <= available    â”‚
     â”‚                           â”‚â—„â”€â”€â”˜                        â”‚
     â”‚                           â”‚                            â”‚
     â”‚                           â”‚  Check Firestore rules     â”‚
     â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚                           â”‚  allow write if            â”‚
     â”‚                           â”‚  auth.uid == userId        â”‚
     â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                           â”‚                            â”‚
     â”‚  3. Action permitted      â”‚                            â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
     â”‚                           â”‚                            â”‚
```

### Validation Rules

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Field                â”‚ Validation Rule                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Referral Code        â”‚ 5-12 alphanumeric characters            â”‚
â”‚                      â”‚ Uppercase conversion                    â”‚
â”‚                      â”‚ Real-time verification                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Withdrawal Amount    â”‚ >= $10 (minimum)                        â”‚
â”‚                      â”‚ <= available balance                    â”‚
â”‚                      â”‚ Numeric only                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PayPal Email         â”‚ Valid email format                      â”‚
â”‚                      â”‚ Required if method = "paypal"           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Bank Details         â”‚ All fields required                     â”‚
â”‚                      â”‚ No special validation (admin verifies)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User Authentication  â”‚ Firebase auth token required            â”‚
â”‚                      â”‚ Session validation                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Flow 9: Analytics & Metrics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    METRICS TRACKING                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SIGNUP METRICS     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Total signups     â”‚
â”‚ â€¢ With referral %   â”‚
â”‚ â€¢ Conversion rate   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REFERRAL METRICS   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Total referrals   â”‚
â”‚ â€¢ Active referrers  â”‚
â”‚ â€¢ Avg per referrer  â”‚
â”‚ â€¢ Top 10 list       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EARNINGS METRICS   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Total paid out    â”‚
â”‚ â€¢ Pending amount    â”‚
â”‚ â€¢ Avg commission    â”‚
â”‚ â€¢ Monthly trend     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WITHDRAWAL METRICS â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Requests pending  â”‚
â”‚ â€¢ Completed today   â”‚
â”‚ â€¢ Avg amount        â”‚
â”‚ â€¢ Processing time   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Flow 10: Success Path Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              REFERRAL PROGRAM SUCCESS TIMELINE                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Day 0: User A Signs Up
â”‚
â”œâ”€â–º Receives referral code: JOH4K7LM
â””â”€â–º Can start sharing immediately

Day 1: User A Shares Link
â”‚
â”œâ”€â–º Shares on social media
â”œâ”€â–º Sends to 10 friends
â””â”€â–º Posts in communities

Day 2: First Referral!
â”‚
â”œâ”€â–º User B signs up via link
â”œâ”€â–º User A sees +1 referral count
â””â”€â–º User A: $0 earnings (User B on free trial)

Day 10: User B Subscribes
â”‚
â”œâ”€â–º User B upgrades to $30/month plan
â”œâ”€â–º User A earns $4.50 commission
â”œâ”€â–º Status: PENDING (7-day hold)
â””â”€â–º Shows in "Pending Balance"

Day 17: Earnings Confirmed
â”‚
â”œâ”€â–º 7 days passed since subscription
â”œâ”€â–º Commission moves to "Available"
â”œâ”€â–º User A: $4.50 available to withdraw
â””â”€â–º Still below $10 minimum

Day 25: More Referrals Subscribe
â”‚
â”œâ”€â–º Users C, D, E subscribe
â”œâ”€â–º User A earns $15.00 more
â”œâ”€â–º After holds: $19.50 available
â””â”€â–º Now above $10 minimum!

Day 30: First Withdrawal
â”‚
â”œâ”€â–º User A requests withdrawal: $15.00
â”œâ”€â–º Method: PayPal
â”œâ”€â–º Status: Pending (awaiting admin)
â””â”€â–º Available balance: $4.50

Day 31: Payout Processed
â”‚
â”œâ”€â–º Admin approves withdrawal
â”œâ”€â–º $15.00 sent to PayPal
â”œâ”€â–º Status: Completed
â””â”€â–º User A: $15.00 earned & withdrawn!

Day 60: Growing Success
â”‚
â”œâ”€â–º 25 total referrals
â”œâ”€â–º 12 converted to paid
â”œâ”€â–º $125.00 total earnings
â”œâ”€â–º $65.00 already withdrawn
â””â”€â–º Building passive income!
```

---

## ğŸš€ Quick Reference: Key Functions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FUNCTION CALL FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

lib/referral.ts Functions:

generateReferralCode(name, email)
    â”‚
    â”œâ”€â–º Strips special characters
    â”œâ”€â–º Takes first 3 letters of name
    â”œâ”€â–º Generates 4 random characters
    â”œâ”€â–º Takes last 2 of email
    â””â”€â–º Returns: "JOH4K7LM"

createReferralData(userId, code, referredByCode)
    â”‚
    â”œâ”€â–º Finds referrer (if code provided)
    â”œâ”€â–º Creates referrals/{userId} document
    â”œâ”€â–º Links to referrer
    â””â”€â–º Updates referrer's stats

findUserByReferralCode(code)
    â”‚
    â”œâ”€â–º Queries referrals collection
    â”œâ”€â–º Finds matching code
    â”œâ”€â–º Retrieves user data
    â””â”€â–º Returns: { userId, name, email }

recordEarnings(referrerId, referredUserId, amount, type, plan)
    â”‚
    â”œâ”€â–º Calculates commission (15% or 20%)
    â”œâ”€â–º Creates earning record
    â”œâ”€â–º Adds to earnings array
    â”œâ”€â–º Updates pendingBalance
    â””â”€â–º Updates totalEarnings

requestWithdrawal(referrerId, amount, method, details)
    â”‚
    â”œâ”€â–º Validates amount >= $10
    â”œâ”€â–º Checks available balance
    â”œâ”€â–º Creates withdrawal record
    â”œâ”€â–º Deducts from availableBalance
    â””â”€â–º Returns: { success, message }
```

---

## ğŸ’¡ Legend

```
Symbols Used in Diagrams:

â”‚  â”œ  â””  â”€    Flow lines and connections
â–º  â—„          Direction of data flow
â”Œ  â”  â””  â”˜    Box corners
â–¼  â–²          Vertical flow direction
â”¤  â”œ          Branch points
...           Continuing pattern

Status Colors (in text):
ğŸ”´ Critical/Urgent
ğŸŸ¡ Medium Priority
ğŸŸ¢ Low Priority/Optional
âœ… Completed
âš ï¸  Warning/Important
```

---

## ğŸ“š Related Documentation

- **REFERRAL_SYSTEM_STATUS.md** - Complete implementation status
- **REFERRAL_ACTION_PLAN.md** - Next steps and tasks
- **REFERRAL_TESTING_GUIDE.md** - Comprehensive testing procedures
- **REFERRAL_SYSTEM_GUIDE.md** - Detailed technical guide
- **README_REFERRAL.md** - User-facing documentation

---

**Document Version**: 1.0  
**Last Updated**: January 2025  
**Purpose**: Visual reference for understanding system flows